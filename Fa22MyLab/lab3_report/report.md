# VE370 Lab3 Report

Weiqing Xu 520021910400 10/25/2022

## General Description

Firstly, my overall modeling and implementation of the processor is under the guidance of the picture below[^1]:
![general\_design](D:/campus/VE370/lab/lab3_report/general_design.jpg)
[^1]:This picture is taken from VE370 T5 slides

Specifically, I have implemented RISC-V instructions including:
- The arithmetic-logical instructions add, addi, sub, and, and or
- The memory-reference instructions lw and sw
- The branch instructions beq and bne

For control signals:

| Inst | RegWrite | ALUsrc | ALUop | Aluctrl | Branch | MemWrite | MemRead | MemtoReg |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| add | 1 | 0 | 10 | 0010 | 0 | 0 | 0 | 0 |
| addi | 1 | 1 | 00 | 0010 | 0 | 0 | 0 | 0 |
| sub | 1 | 0 | 10 | 0110 | 0 | 0 | 0 | 0 |
| and | 1 | 0 | 10 | 0000 | 0 | 0 | 0 | 0 |
| or | 1 | 0 | 10 | 0001 | 0 | 0 | 0 | 0 |
| lw | 1 | 1 | 00 | 0010 | 0 | 0 | 1 | 1 |
| sw | 0 | 1 | 00 | 0010 | 0 | 1 | 0 | 0 |
| beq | 0 | 0 | 01 | 0110 | 1 | 0 | 0 | 0 |
| bne | 0 | 0 | 01 | 0111 | 1 | 0 | 0 | 0 |

## RTL schematic of my Verilog model
This is my RTL schematic of Verilog model generated with Xilinx Vivado software:
![RTL_schematic](D:/campus/VE370/lab/lab3_report/schematic.png)

## Simulations
### Register File
The detailed design:
![reg](D:/campus/VE370/lab/lab3_report/reg.jpg)
Simulation result:
![sim_reg](D:/campus/VE370/lab/lab3_report/sim_reg.jpg)

### 32-bit ALU
The detailed design:
![ALU](D:/campus/VE370/lab/lab3_report/ALU.jpg)
Simulation result:
![sim_ALU](D:/campus/VE370/lab/lab3_report/sim_ALU.jpg)

### 32-bit Adder
The detailed design:
![Adder](D:/campus/VE370/lab/lab3_report/Adder.jpg)
Simulation result:
![sim_Adder](D:/campus/VE370/lab/lab3_report/sim_Adder.jpg)

### Immediate Generator
The detailed design:
![ImmGen](D:/campus/VE370/lab/lab3_report/ImmGen.jpg)
Simulation result:
![sim_ImmGen](D:/campus/VE370/lab/lab3_report/sim_ImmGen.jpg)

### Control Unit
The detailed design:
![Control](D:/campus/VE370/lab/lab3_report/Control.jpg)
Simulation result:
![sim_Control](D:/campus/VE370/lab/lab3_report/sim_Control.jpg)

### ALU control
The detailed design:
![ALUcontrol](D:/campus/VE370/lab/lab3_report/ALUcontrol.jpg)
Simulation result:
![sim_ALUcontrol](D:/campus/VE370/lab/lab3_report/sim_ALUcontrol.jpg)

### 2-to-1 MUX
The detailed design:
![MUX](D:/campus/VE370/lab/lab3_report/mux.jpg)
Simulation result:
![sim_MUX](D:/campus/VE370/lab/lab3_report/sim_Mux.jpg)

### Data Memory
Part of the detailed design(the whole schematic is too large):
![Data_Mem](D:/campus/VE370/lab/lab3_report/Data_Mem.jpg)
Simulation result:
![sim_DataMem](D:/campus/VE370/lab/lab3_report/sim_DataMem.jpg)

### Simulation Results for Test Instructions
A testcase of instructions are given:

```
        addi t0 x0 -10
        add t1 t0 t0
        sub t2 t0 t1
        and t3 t1 x0
        or t4 t1 t0
        sw t4 0(x0)
        sw t0 4(x0)
        beq t0 x0 L1
        add t4 t1 x0 # possible error
L1:     bne t1 t4 error1
        bne t1 t3 L2
error1: add t2 x0 x0
L2:     lw s0 0(x0)
        lw s1 4(x0)
        addi s1 s1 8
        beq s0 s1 L3
error2: add t2 x0 x0
L3:     add t2 t2 t2
```
The simulation result is:

```
time:                   6
PC:00000000000000000000000000000000
Inst:4284482195
x5(t0):00000000000000000000000000000000
x6(t1):00000000000000000000000000000000
x7(t2):00000000000000000000000000000000
x28(t3):00000000000000000000000000000000
x29(t4):00000000000000000000000000000000
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:00000000000000000000000000000000
Mem[4]:00000000000000000000000000000000
time:                  12
PC:00000000000000000000000000000100
Inst:   5407539
x5(t0):11111111111111111111111111110110
x6(t1):00000000000000000000000000000000
x7(t2):00000000000000000000000000000000
x28(t3):00000000000000000000000000000000
x29(t4):00000000000000000000000000000000
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:00000000000000000000000000000000
Mem[4]:00000000000000000000000000000000
time:                  18
PC:00000000000000000000000000001000
Inst:1080198067
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000000000
x28(t3):00000000000000000000000000000000
x29(t4):00000000000000000000000000000000
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:00000000000000000000000000000000
Mem[4]:00000000000000000000000000000000
time:                  24
PC:00000000000000000000000000001100
Inst:    228915
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):00000000000000000000000000000000
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:00000000000000000000000000000000
Mem[4]:00000000000000000000000000000000
time:                  30
PC:00000000000000000000000000010000
Inst:   5467827
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):00000000000000000000000000000000
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:00000000000000000000000000000000
Mem[4]:00000000000000000000000000000000
time:                  36
PC:00000000000000000000000000010100
Inst:  30416931
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111111110
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:00000000000000000000000000000000
Mem[4]:00000000000000000000000000000000
time:                  42
PC:00000000000000000000000000011000
Inst:   5251619
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111111110
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:11111111111111111111111111111110
Mem[4]:00000000000000000000000000000000
time:                  48
PC:00000000000000000000000000011100
Inst:    164963
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111111110
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:11111111111111111111111111111110
Mem[4]:11111111111111111111111111110110
time:                  54
PC:00000000000000000000000000100000
Inst:    200371
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111111110
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:11111111111111111111111111111110
Mem[4]:11111111111111111111111111110110
time:                  60
PC:00000000000000000000000000100100
Inst:  30610531
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111101100
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:11111111111111111111111111111110
Mem[4]:11111111111111111111111111110110
time:                  66
PC:00000000000000000000000000101000
Inst:  29561955
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111101100
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:11111111111111111111111111111110
Mem[4]:11111111111111111111111111110110
time:                  72
PC:00000000000000000000000000110000
Inst:      9219
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111101100
x8(s0):00000000000000000000000000000000
x9(s1):00000000000000000000000000000000
Mem[0]:11111111111111111111111111111110
Mem[4]:11111111111111111111111111110110
time:                  78
PC:00000000000000000000000000110100
Inst:   4203651
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111101100
x8(s0):11111111111111111111111111111110
x9(s1):00000000000000000000000000000000
Mem[0]:11111111111111111111111111111110
Mem[4]:11111111111111111111111111110110
time:                  84
PC:00000000000000000000000000111000
Inst:   8684691
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111101100
x8(s0):11111111111111111111111111111110
x9(s1):11111111111111111111111111110110
Mem[0]:11111111111111111111111111111110
Mem[4]:11111111111111111111111111110110
time:                  90
PC:00000000000000000000000000111100
Inst:   9700451
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111101100
x8(s0):11111111111111111111111111111110
x9(s1):11111111111111111111111111111110
Mem[0]:11111111111111111111111111111110
Mem[4]:11111111111111111111111111110110
time:                  96
PC:00000000000000000000000001000100
Inst:   7570355
x5(t0):11111111111111111111111111110110
x6(t1):11111111111111111111111111101100
x7(t2):00000000000000000000000000001010
x28(t3):00000000000000000000000000000000
x29(t4):11111111111111111111111111101100
x8(s0):11111111111111111111111111111110
x9(s1):11111111111111111111111111111110
Mem[0]:11111111111111111111111111111110
Mem[4]:11111111111111111111111111110110
```
